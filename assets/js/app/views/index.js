// Generated by CoffeeScript 1.6.2
(function() {
  define(['backbone'], function(Backbone) {
    var IndexView;

    return IndexView = Backbone.View.extend({
      initialize: function() {
        _.bindAll(this);
        return this.getTumblr();
      },
      getInstagram: function() {
        $.ajax({
          type: 'GET',
          dataType: 'jsonp',
          url: "https://api.instagram.com/v1/users/14250732/media/recent/?access_token=16304963.457f60c.d89e49ea943c44e29308004e99a9d8da&count=100",
          success: this.haveInstagramData
        });
      },
      instagramTemplate: _.template("<img src=\"<%= images.standard_resolution.url %>\" />\n<% if(caption){ %>\n	<p><%= caption.text %></p>\n<% } %>"),
      haveInstagramData: function(data) {
        var _this = this;

        return _.each(this.$('.instagram'), function(el, index) {
          var $el, gram;

          $el = $(el);
          gram = data.data[index];
          if (gram != null) {
            return $el.append(_this.instagramTemplate(gram));
          }
        });
      },
      getTumblr: function() {
        return $.ajax({
          url: 'http://api.tumblr.com/v2/blog/commonthings.tumblr.com/posts',
          dataType: 'jsonp',
          type: 'GET',
          data: {
            api_key: "YgpsEXCrpCtKL9U7aNBzWeDp0sSbZw1AeZQSt5QgsXRLdb5o24",
            limit: 50,
            offset: 0
          },
          success: this.haveTumblrData
        });
      },
      tumblrTemplate: _.template("<a href=\"<%= link_url %>\" target=\"_blank\">\n	<div class=\"image\">\n		<img src=\"<%= photos[0].original_size.url %>\" />\n	</div>\n</a>"),
      haveTumblrData: function(data) {
        var _this = this;

        return _.each(this.$('.tumblr'), function(el, index) {
          var $el, post;

          $el = $(el);
          post = data.response.posts[index];
          $el.append(_this.tumblrTemplate(post));
          return $el.find('.preloader').remove();
        });
      },
      getSvpply: function() {
        return $.ajax({
          type: 'GET',
          dataType: 'jsonp',
          url: 'https://api.svpply.com/v1/users/jarred/wants/products.json?callback=?',
          success: this.haveSvpplyData
        });
      },
      svpplyTemplate: _.template("<a href=\"<%= page_url %>\" target=\"_blank\">\n	<div class=\"image\">\n		<img src=\"<%= image %>\" />\n	</div>\n	<div class=\"info\">\n		<h3><%= page_title %></h3>\n		<h4>from <em><%= store.name %></em></h4>\n	</div>\n</a>"),
      haveSvpplyData: function(data) {
        var _this = this;

        return _.each(this.$('.svpply'), function(el, index) {
          var $el, post;

          $el = $(el);
          post = data.response.products[index];
          $el.append(_this.svpplyTemplate(post));
          return $el.find('.preloader').remove();
        });
      }
    });
  });

}).call(this);
